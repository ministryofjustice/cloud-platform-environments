#!/usr/bin/env ruby

require File.join(".", File.dirname(__FILE__), "..", "lib", "cp_env")

def main(cluster)
  log("green", "applying for cluster #{cluster}")

  set_kube_context(cluster)

  apply_cluster_level_resources(cluster)

  all_namespace_dirs(cluster).each do |namespace_dir|
    CpEnv::NamespaceDir.new(cluster: cluster, dir: namespace_dir).apply
  end

  log("green", "Done.")
end

main ENV.fetch("PIPELINE_CLUSTER")
