resource "cert-manager-certificate" "certificate" {
  count = length(var.domains)

  metadata {
    name      = var.domains[count.index].name
    namespace = "hale-platform-prod"
  }

  spec {
    secret_name = "${var.domains[count.index].domain_key}-cert"

    issuer_ref {
      name = "letsencrypt-production"
      kind = "ClusterIssuer"
    }

    dns_names = [
      var.domains[count.index].name
    ]
  }
}

variable "domains" {
  type = list(object({
    name       = string
    domain_key = string
  }))
  default = [
    {
      name       = "magistrates.judiciary.uk"
      domain_key = "magistrates"
    },
    {
      name       = "victimscommissioner.org.uk"
      domain_key = "victimscommissioner"
    },
    {
      name       = "www.victimscommissioner.org.uk"
      domain_key = "victimscommissioner-www"
    },
    {
      name       = "publicdefenderservice.org.uk"
      domain_key = "publicdefenderservice"
    },
    {
      name       = "www.publicdefenderservice.org.uk"
      domain_key = "publicdefenderservice-www"
    },
    {
      name       = "imb.org.uk"
      domain_key = "imb"
    },
    {
      name       = "www.imb.org.uk"
      domain_key = "imb-www"
    },
    {
      name       = "my.imb.org.uk"
      domain_key = "my-imb"
    },
    {
      name       = "ccrc.gov.uk"
      domain_key = "ccrc"
    },
    {
      name       = "www.ccrc.gov.uk"
      domain_key = "ccrc-www"
    },
    {
      name       = "icrir.independent-inquiry.uk"
      domain_key = "icrir"
    },
    {
      name       = "prisonandprobationjobs.gov.uk"
      domain_key = "ppj"
    },
    {
      name       = "www.prisonandprobationjobs.gov.uk"
      domain_key = "ppj-www"
    },
    {
      name       = "brookhouseinquiry.org.uk"
      domain_key = "brookhouse"
    },
    {
      name       = "www.brookhouseinquiry.org.uk"
      domain_key = "brookhouse-www"
    },
    {
      name       = "layobservers.org"
      domain_key = "layobservers"
    },
    {
      name       = "www.layobservers.org"
      domain_key = "layobservers-www"
    },
    {
      name       = "members.layobservers.org"
      domain_key = "layobservers-members"
    },
    {
      name       = "sifocc.org"
      domain_key = "sifocc"
    },
    {
      name       = "www.sifocc.org"
      domain_key = "sifocc-www"
    },
    {
      name       = "nationalpreventivemechanism.org.uk"
      domain_key = "nationalpreventivemechanism"
    },
    {
      name       = "www.nationalpreventivemechanism.org.uk"
      domain_key = "nationalpreventivemechanism-www"
    },
    {
      name       = "jobs.justice.gov.uk"
      domain_key = "justicejobs"
    },
    {
      name       = "www.jobs.justice.gov.uk"
      domain_key = "justicejobs-www"
    },
    {
      name       = "ppo.gov.uk"
      domain_key = "ppo"
    },
    {
      name       = "www.ppo.gov.uk"
      domain_key = "ppo-www"
    },
    {
      name       = "lawcom.gov.uk"
      domain_key = "lawcom"
    },
    {
      name       = "www.lawcom.gov.uk"
      domain_key = "lawcom-www"
    },
    {
      name       = "victimandwitnessinformation.org.uk"
      domain_key = "victimandwitnessinformation"
    },
    {
      name       = "www.victimandwitnessinformation.org.uk"
      domain_key = "victimandwitnessinformation-www"
    },
    {
      name       = "cym.victimandwitnessinformation.org.uk"
      domain_key = "victimandwitnessinformation-cym"
    },
    {
      name       = "victimscode.org.uk"
      domain_key = "victimscode"
    }
  ]
}
