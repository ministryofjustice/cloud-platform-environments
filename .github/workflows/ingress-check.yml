name: Ingress checker
on:
  pull_request:
    # Sequence of patterns matched against refs/heads
    branches:    
      # Push events on main branch
      - ingress-checker

jobs:
  ingress-checker:
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [ubuntu-latest]

    steps:
      - name: Checkout PR code
        uses: actions/checkout@master

      - name: Get all files changed in PR
        id: files
        uses: Ana06/get-changed-files@v1.2
        with:
          filter: '*.live.cloud*'
      - run: |
          echo "action_state=${{ steps.files.outputs.all }} | awk -F/ '{print $3}'" >> $GITHUB_ENV

      - name: run jq
        run: 
          curl -s i -H "Accept: application/json" https://reports.cloud-platform.service.justice.gov.uk/ingress_weighting  | jq -r '.weighting_ingress[] | select(.namespace=="${{ env.action_state }}")'

          # echo "${{ env.action_state }}" # This will output 'yellow'
