on:
  pull_request:
    paths:
      - 'namespaces/live.cloud-platform.service.justice.gov.uk/aaf-dev/**'
  workflow_dispatch:
    
jobs:
  ecr-deletion-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # - uses: ministryofjustice/cloud-platform-ecr-deletion-check-action@main

      - name: Get changed files
        id: files
        uses: tj-actions/changed-files@v43
        with:
          files_ignore: .github/**
    
      - name: Run 
        run: |
            status=0
            for file in ${{ steps.files.outputs.all_changed_files }}; do
              echo $file
            done
            exit $status
      - name: Run ecr deleted files check
        run: |
          echo "Hello"
          echo $GITHUB_SHA
          DELETED_FILES=$(git diff --name-status origin/main $GITHUB_SHA | awk '$1 == "D" { print $2 }')
          echo "Deleted files: $DELETED_FILES" 
          ECR_DELETED=$(cat "$DELETED_FILES" | grep -q 'github.com/ministryofjustice/cloud-platform-terraform-ecr-credentials' && echo true || echo false)
          echo "::set-output name=ecr_deleted::${ECR_DELETED}"

