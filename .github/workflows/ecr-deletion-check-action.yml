on:
  pull_request:
    paths:
      - 'namespaces/live.cloud-platform.service.justice.gov.uk/aaf-dev/**'
  workflow_dispatch:
    
jobs:
  ecr-deletion-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # - uses: ministryofjustice/cloud-platform-ecr-deletion-check-action@main

      - name: Run ecr deleted files check
        run: |
          echo "Hello"
          DELETED_FILES=$(git diff --name-status origin/main $GITHUB_SHA | awk '$1 == "D" { print $2 }')
          echo "Deleted files: $DELETED_FILES" 
          cd $GITHUB_WORKSPACE
          ls -al
          git checkout main          
          ECR_DELETED=$(cat "$DELETED_FILES" | grep -q 'github.com/ministryofjustice/cloud-platform-terraform-ecr-credentials' && echo true || echo false)
          echo "::set-output name=ecr_deleted::${ECR_DELETED}"

