name: conftest
on: [pull_request]

jobs:
  conftest:
    env:
      # List of files/dirs to ignore
      IGNORE_LIST: "namespaces/live.cloud-platform.service.justice.gov.uk/monitoring/oidc-components-secret.yaml|namespaces/live.cloud-platform.service.justice.gov.uk/operations-engineering/secret.yaml|namespaces/live.cloud-platform.service.justice.gov.uk/polygraph-offender-management/resources/poms-secrets|namespaces/live.cloud-platform.service.justice.gov.uk/cloud-platform-canary-app-eks"
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3

      - name: Setup conftest
        uses: princespaghetti/setup-conftest@v1.1.18

      - name: Run Conftest 
        run: conftest test namespaces/live.cloud-platform.service.justice.gov.uk/ --ignore $IGNORE_LIST
        continue-on-error: true